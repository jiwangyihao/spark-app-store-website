import{i as H,aI as L,v as W,r as p,x as k,aC as B,aD as F,o as d,w as S,a7 as f,z as g,A as h,F as $,D as b,aE as m,E as y,aF as C,B as u,H as T}from"./index.501f1fa2.js";import{api as w}from"./api.ac7a10cc.js";import{u as A}from"./store.21ad56fb.js";import{_ as N}from"./plugin-vue_export-helper.21dcd24c.js";function R(){return H(L)}const q=["onMousedown","onMouseup"],G=["onTransitionend"],V=["src","onError"],j={class:"description"},K=W({__name:"SortPage",setup(O){const _=R(),o=p(),l=k(),P=B(),r=A(),{sortCache:e}=F(A());console.log(e.value),d(()=>{S(()=>l.params.sort,()=>{if(l.params.sort&&e.value.sort!==l.params.sort.toString()){e.value.sort=l.params.sort.toString();async function t(){const a=await w.getApplicationList(l.params.sort.toString());a.length>0?(e.value.appList=z(a),e.value.sort=l.params.sort.toString(),cancelAnimationFrame(i.value.animationId),o.value.parentElement.parentElement.scrollTo({top:o.value.parentElement.parentElement.scrollTop,behavior:"smooth"})):await P.push("/Error404")}e.value.coverState.active?(e.value.coverState.active=!1,e.value.coverState.open=!1,e.value.coverState.loaded=!1,e.value.containerState.cover=!1,e.value.coverState.animation=!0,setTimeout(t,2e3)):t().catch(a=>{_.notify({type:"negative",message:a.toString()})})}},{immediate:!0})});const v=p(0);function z(t){return t.forEach((a,n)=>{var s,c;a.position={left:n%e.value.column*(e.value.horizonGap+e.value.config.gap+e.value.config.cardWidth)+e.value.config.horizonPadding+e.value.horizonGap,top:Math.floor(n/e.value.column)*(e.value.config.cardHeight+e.value.config.gap)+e.value.config.verticalPadding},a.style=`transform:translate(${(s=a.position)==null?void 0:s.left}px,${(c=a.position)==null?void 0:c.top}px)`,a.hasOwnProperty("class")||(a.class={active:!1,animation:!1,appCard:!0,cover:!1}),r.setImgError(a,!1)}),t}d(()=>{var t;v.value=(t=o.value)==null?void 0:t.clientWidth,r.onContainerWidthChange(v.value),window.addEventListener("resize",f(()=>{var a;v.value=(a=o.value)==null?void 0:a.clientWidth,r.onContainerWidthChange(v.value)},250)),o.value.parentElement.parentElement.addEventListener("scroll",f(a=>{r.onScroll(a.target.scrollTop)},250)),r.onContainerHeightChange(o.value.parentElement.parentElement.clientHeight),o.value.parentElement.parentElement.addEventListener("resize",f(()=>{r.onContainerHeightChange(o.value.parentElement.parentElement.clientHeight)},250))});const i=p({originTop:0,targetTop:0,animationId:0});d(()=>{S(r.sortCache,t=>{if(t.columnAnimation.change){const a=t.columnAnimation.newColumn,n=t.columnAnimation.oldColumn;console.log(a,n),t.columnAnimation.change=!1;const s=i.value.targetTop?i.value.targetTop:t.scrollTop;i.value.targetTop=(s-t.config.verticalPadding+o.value.parentElement.parentElement.clientHeight/2)*n/a-o.value.parentElement.parentElement.clientHeight/2+t.config.verticalPadding,o.value.parentElement.parentElement.scrollTo({top:i.value.targetTop,behavior:"smooth"})}},{deep:!0})});function D(t){var a;e.value.containerState.active=!0,e.value.containerState.animation=!0,(a=e.value.activeCard)!=null&&a.class&&(e.value.activeCard.class.cover=!1),t.class&&(t.class.active=!0,t.class.animation=!0),r.setActiveCard(t),x(t.Package)}function I(t){e.value.containerState.active=!1,e.value.containerState.cover=!0,t.class&&(t.class.active=!1,t.class.cover=!0),e.value.coverState.active=!0}function M(t,a){a.propertyName==="transform"&&(e.value.containerState.animation=!1,t.class&&(t.class.animation=!1))}const E=H("appDetail");function x(t){w.getApplicationDetail(t).then(a=>{E&&(E.value=a),e.value.coverState.loaded=!0}).catch(a=>{_.notify({type:"negative",message:a.toString()})})}return(t,a)=>(g(),h("div",{class:y(["sort-container",m(e).containerState]),style:C({height:m(e).containerHeight}),ref_key:"container",ref:o},[(g(!0),h($,null,b(m(e).appList,(n,s)=>(g(),h("div",{style:C(n.style),class:y(["card",n.class]),key:s,onMousedown:()=>D(n),onMouseup:()=>I(n)},[u("div",{class:"cardView",onTransitionend:c=>M(n,c)},[u("img",{src:n.imgSrc,alt:"",onError:c=>m(r).setImgError(n,!0)},null,40,V),u("div",j,[u("h6",null,T(n.Name),1),u("p",null,T(n.More),1)])],40,G)],46,q))),128))],6))}});var Y=N(K,[["__scopeId","data-v-1c686d68"]]);export{Y as default};
