import{Q as M}from"./QScrollArea.f8175d7b.js";import{d as b,r as m,x as L,ao as W,ap as B,o as f,w as _,a7 as E,i as R,z as g,G as $,C as F,B as i,A as y,D as G,ar as C,E as T,aq as d,H as w,F as N}from"./index.8f6c09cd.js";import{a as Q,u as A}from"./use-quasar.09340cb5.js";import{api as x}from"./api.74bd1fae.js";import{_ as q}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-dark.f631bcd6.js";import"./QResizeObserver.9b169893.js";import"./scroll.c700fd77.js";import"./selection.52074fb0.js";const V=["onMousedown","onMouseup"],j=["onTransitionend"],O=["src","onError"],U={class:"description"},J=b({__name:"SortPage",setup(K){const h=Q(),r=m(),c=m(),l=L(),z=W(),n=A(),{sortCache:e}=B(A());f(()=>{_(()=>l.params.sort,()=>{if(l.params.sort&&e.value.sort!==l.params.sort.toString()){e.value.sort=l.params.sort.toString();async function t(){const a=await x.getApplicationList(l.params.sort.toString());a.length>0?(e.value.appList=H(a),e.value.sort=l.params.sort.toString(),cancelAnimationFrame(p.value.animationId),r.value.parentElement.parentElement.scrollTo({top:r.value.parentElement.parentElement.scrollTop,behavior:"smooth"})):await z.push("/Error404")}e.value.coverState.active?(e.value.coverState.active=!1,e.value.coverState.open=!1,e.value.coverState.loaded=!1,e.value.containerState.cover=!1,e.value.coverState.animation=!0,setTimeout(t,2e3)):t().catch(a=>{h.notify({type:"negative",message:a.toString()})})}},{immediate:!0})});const v=m(0);function H(t){return t.forEach((a,o)=>{var s,u;a.position={left:o%e.value.column*(e.value.horizonGap+e.value.config.gap+e.value.config.cardWidth)+e.value.config.horizonPadding+e.value.horizonGap,top:Math.floor(o/e.value.column)*(e.value.config.cardHeight+e.value.config.gap)+e.value.config.verticalPadding},a.style=`transform:translate(${(s=a.position)==null?void 0:s.left}px,${(u=a.position)==null?void 0:u.top}px)`,a.hasOwnProperty("class")||(a.class={active:!1,animation:!1,appCard:!0,cover:!1}),n.setImgError(a,!1)}),t}f(()=>{var t;v.value=(t=r.value)==null?void 0:t.clientWidth,n.onContainerWidthChange(v.value),window.addEventListener("resize",E(()=>{var a;v.value=(a=r.value)==null?void 0:a.clientWidth,n.onContainerWidthChange(v.value)},250)),c.value.getScrollTarget().addEventListener("scroll",a=>{var o;return n.onScroll((o=a==null?void 0:a.target)==null?void 0:o.scrollTop)}),n.onClientHeightChange(c.value.getScrollTarget().parentElement.parentElement.clientHeight-30),c.value.getScrollTarget().parentElement.parentElement.addEventListener("resize",E(()=>{n.onClientHeightChange(c.value.getScrollTarget().parentElement.parentElement.clientHeight-30)},250))});const p=m({originTop:0,targetTop:0,animationId:0});f(()=>{_(n.sortCache,t=>{if(t.columnAnimation.change){const a=t.columnAnimation.newColumn,o=t.columnAnimation.oldColumn;console.log(a,o),t.columnAnimation.change=!1;const s=t.scrollTop;p.value.targetTop=(s-t.config.verticalPadding+r.value.parentElement.parentElement.clientHeight/2)*o/a-r.value.parentElement.parentElement.clientHeight/2+t.config.verticalPadding,r.value.parentElement.parentElement.scrollTo({top:p.value.targetTop,behavior:"smooth"})}},{deep:!0})});function P(t){var a;e.value.containerState.active=!0,e.value.containerState.animation=!0,(a=e.value.activeCard)!=null&&a.class&&(e.value.activeCard.class.cover=!1),t.class&&(t.class.active=!0,t.class.animation=!0),n.setActiveCard(t),I(t.Package)}function k(t){e.value.containerState.active=!1,e.value.containerState.cover=!0,t.class&&(t.class.active=!1,t.class.cover=!0),e.value.coverState.active=!0}function D(t,a){a.propertyName==="transform"&&(e.value.containerState.animation=!1,t.class&&(t.class.animation=!1))}const S=R("appDetail");function I(t){x.getApplicationDetail(t).then(a=>{S&&(S.value=a),e.value.coverState.loaded=!0}).catch(a=>{h.notify({type:"negative",message:a.toString()})})}return(t,a)=>(g(),$(M,{style:{width:"calc(100% - 60px)"},"thumb-style":{zIndex:"2",borderRadius:"100px"},visible:!1,ref_key:"scrollArea",ref:c,class:"scroll-container"},{default:F(()=>[i("div",{class:T(["sort-container",d(e).containerState]),style:C({height:d(e).containerHeight}),ref_key:"container",ref:r},[(g(!0),y(N,null,G(d(e).appList,(o,s)=>(g(),y("div",{style:C(o.style),class:T(["card",o.class]),key:s,onMousedown:()=>P(o),onMouseup:()=>k(o)},[i("div",{class:"cardView",onTransitionend:u=>D(o,u)},[i("img",{src:o.imgSrc,alt:"",onError:u=>d(n).setImgError(o,!0)},null,40,O),i("div",U,[i("h6",null,w(o.Name),1),i("p",null,w(o.More),1)])],40,j)],46,V))),128))],6)]),_:1},512))}});var le=q(J,[["__scopeId","data-v-410d8c94"]]);export{le as default};
