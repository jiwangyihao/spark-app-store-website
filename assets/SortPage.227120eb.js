import{i as H,aI as L,v as W,r as m,x as b,aC as k,aD as F,o as d,w as S,a7 as f,z as g,A as h,F as B,D as $,aE as p,E as y,aF as C,B as c,H as T}from"./index.361230ea.js";import{api as w}from"./api.ac7a10cc.js";import{u as A}from"./store.1f6b72e3.js";import{_ as N}from"./plugin-vue_export-helper.21dcd24c.js";function R(){return H(L)}const q=["onMousedown","onMouseup"],G=["onTransitionend"],V=["src","onError"],j={class:"description"},K=W({__name:"SortPage",setup(O){const E=R(),n=m(),l=b(),P=k(),r=A(),{sortCache:e}=F(A());console.log(e.value),d(()=>{S(()=>l.params.sort,()=>{if(l.params.sort&&e.value.sort!==l.params.sort.toString()){e.value.sort=l.params.sort.toString();async function a(){const t=await w.getApplicationList(l.params.sort.toString());t.length>0?(e.value.appList=z(t),e.value.sort=l.params.sort.toString(),cancelAnimationFrame(s.value.animationId),n.value.parentElement.parentElement.scrollTo({top:n.value.parentElement.parentElement.scrollTop,behavior:"smooth"})):await P.push("/Error404")}e.value.coverState.active?(e.value.coverState.active=!1,e.value.coverState.open=!1,e.value.coverState.loaded=!1,e.value.containerState.cover=!1,e.value.coverState.animation=!0,setTimeout(a,2e3)):a().catch(t=>{E.notify({type:"negative",message:t.toString()})})}},{immediate:!0})});const u=m(0);function z(a){return a.forEach((t,o)=>{var v,i;t.position={left:o%e.value.column*(e.value.horizonGap+e.value.config.gap+e.value.config.cardWidth)+e.value.config.horizonPadding+e.value.horizonGap,top:Math.floor(o/e.value.column)*(e.value.config.cardHeight+e.value.config.gap)+e.value.config.verticalPadding},t.style=`transform:translate(${(v=t.position)==null?void 0:v.left}px,${(i=t.position)==null?void 0:i.top}px)`,t.hasOwnProperty("class")||(t.class={active:!1,animation:!1,appCard:!0,cover:!1}),r.setImgError(t,!1)}),a}d(()=>{var a;u.value=(a=n.value)==null?void 0:a.clientWidth,r.onContainerWidthChange(u.value),window.addEventListener("resize",f(()=>{var t;u.value=(t=n.value)==null?void 0:t.clientWidth,r.onContainerWidthChange(u.value)},250)),n.value.parentElement.parentElement.addEventListener("scroll",f(()=>{r.onScroll(n.value.parentElement.parentElement.scrollTop)},250)),r.onContainerHeightChange(n.value.parentElement.parentElement.clientHeight),n.value.parentElement.parentElement.addEventListener("resize",f(()=>{r.onContainerHeightChange(n.value.parentElement.parentElement.clientHeight)},250))});const s=m({originTop:0,targetTop:0,animationId:0});d(()=>{S(e.value,({column:a},{column:t})=>{if(a!==t){cancelAnimationFrame(s.value.animationId);const o=s.value.targetTop?s.value.targetTop:n.value.parentElement.parentElement.scrollTop;s.value.targetTop=(o-e.value.config.verticalPadding+n.value.parentElement.parentElement.clientHeight/2)*t/a-n.value.parentElement.parentElement.clientHeight/2+e.value.config.verticalPadding,n.value.parentElement.parentElement.scrollTo({top:s.value.targetTop,behavior:"smooth"})}})});function D(a){var t;e.value.containerState.active=!0,e.value.containerState.animation=!0,(t=e.value.activeCard)!=null&&t.class&&(e.value.activeCard.class.cover=!1),a.class&&(a.class.active=!0,a.class.animation=!0),r.setActiveCard(a),x(a.Package)}function I(a){e.value.containerState.active=!1,e.value.containerState.cover=!0,a.class&&(a.class.active=!1,a.class.cover=!0),e.value.coverState.active=!0}function M(a,t){t.propertyName==="transform"&&(e.value.containerState.animation=!1,a.class&&(a.class.animation=!1))}const _=H("appDetail");function x(a){w.getApplicationDetail(a).then(t=>{_&&(_.value=t),e.value.coverState.loaded=!0}).catch(t=>{E.notify({type:"negative",message:t.toString()})})}return(a,t)=>(g(),h("div",{class:y(["sort-container",p(e).containerState]),style:C({height:p(e).containerHeight}),ref_key:"container",ref:n},[(g(!0),h(B,null,$(p(e).appList,(o,v)=>(g(),h("div",{style:C(o.style),class:y(["card",o.class]),key:v,onMousedown:()=>D(o),onMouseup:()=>I(o)},[c("div",{class:"cardView",onTransitionend:i=>M(o,i)},[c("img",{src:o.imgSrc,alt:"",onError:i=>p(r).setImgError(o,!0)},null,40,V),c("div",j,[c("h6",null,T(o.Name),1),c("p",null,T(o.More),1)])],40,G)],46,q))),128))],6))}});var Y=N(K,[["__scopeId","data-v-271ebebe"]]);export{Y as default};
