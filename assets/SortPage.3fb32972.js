import{i as m,aE as R,v as V,r as v,x as K,aF as O,o as P,w as S,c as p,a7 as H,z as w,A as $,F as Q,D as U,E as k,aG as J,aC as D,B as _,H as I}from"./index.1a8d83d2.js";import{api as W}from"./api.31ee6ffb.js";import{u as X}from"./store.ee6df7ef.js";import{_ as Y}from"./plugin-vue_export-helper.21dcd24c.js";var Z="/spark-store-qe/assets/application.bc4a430e.svg";function ee(){return m(R)}const ae=["onMousedown","onMouseup"],te=["onTransitionend"],ne=["src","onError"],oe={class:"description"},le=V({__name:"SortPage",setup(re){const x=ee(),r=v(),y=m("cover"),s=m("containerState"),o=m("coverState"),i=m("activeCard"),g=K(),b=O(),B=X(),T=v([]),F=v(B.source),z=v(g.params.sort.toString());P(()=>{S(()=>g.params.sort,()=>{if(g.params.sort){async function e(){const a=await W.getApplicationList(g.params.sort.toString());a.length>0?(T.value=L(a),z.value=g.params.sort.toString(),cancelAnimationFrame(d.value.animationId),r.value.parentElement.parentElement.scrollTo({top:r.value.parentElement.parentElement.scrollTop,behavior:"smooth"})):await b.push("/Error404")}o!=null&&o.value.active?(o.value.active=!1,o.value.open=!1,o.value.loaded=!1,s!=null&&s.value&&(s.value.cover=!1),o.value.animation=!0,setTimeout(e,2e3)):e().catch(a=>{x.notify({type:"negative",message:a.toString()})})}},{immediate:!0})});const t={cardWidth:264,cardHeight:92,verticalPadding:50,horizonPadding:16,gap:32},h=v(0),C=p(()=>`${Math.ceil(T.value.length/f.value)*(t.cardHeight+t.gap)+t.gap+t.verticalPadding*1.5}px`),f=p(()=>Math.floor((h.value+t.gap-t.horizonPadding*2)/(t.cardWidth+t.gap))),A=p(()=>(h.value-(t.cardWidth+t.gap)*f.value+t.gap-t.horizonPadding*2)/(f.value+1));function L(e){var l;e.forEach((n,c)=>{n.position={left:p(()=>c%f.value*(A.value+t.gap+t.cardWidth)+t.horizonPadding+A.value),top:p(()=>Math.floor(c/f.value)*(t.cardHeight+t.gap)+t.verticalPadding)},n.style=p(()=>{var u,E;return`transform:translate(${(u=n.position)==null?void 0:u.left.value}px,${(E=n.position)==null?void 0:E.top.value}px)`}),n.hasOwnProperty("class")||(n.class={active:!1,animation:!1,appCard:!0,cover:!1}),n.imgError=v(!1),n.imgSrc=p(()=>{var u;return(u=n.imgError)!=null&&u.value?Z:`${F.value}/store/${z.value}/${n.Package.replaceAll("+","%2B")}/icon.png`})});const a=v((l=r.value)==null?void 0:l.parentElement.parentElement.scrollTop);return y!=null&&y.value&&(y.value.style=p(()=>{var n,c,u,E;return`--j-left:${((c=(n=i==null?void 0:i.value)==null?void 0:n.position)==null?void 0:c.left)-h.value/2-30}px;--j-top:${((E=(u=i==null?void 0:i.value)==null?void 0:u.position)==null?void 0:E.top)-r.value.parentElement.parentElement.clientHeight/2-a.value-15}px;`})),r.value.parentElement.parentElement.addEventListener("scroll",H(()=>{var n;d.value.animationId||(a.value=(n=r.value)==null?void 0:n.parentElement.parentElement.scrollTop)},250)),e}P(()=>{var e;h.value=(e=r.value)==null?void 0:e.clientWidth,window.addEventListener("resize",H(()=>{var a;h.value=(a=r.value)==null?void 0:a.clientWidth},250))});const d=v({originTop:0,targetTop:0,animationId:0});P(()=>{S(f,(e,a)=>{cancelAnimationFrame(d.value.animationId);const l=d.value.targetTop?d.value.targetTop:r.value.parentElement.parentElement.scrollTop;d.value.targetTop=(l-t.verticalPadding+r.value.parentElement.parentElement.clientHeight/2)*a/e-r.value.parentElement.parentElement.clientHeight/2+t.verticalPadding,r.value.parentElement.parentElement.scrollTo({top:d.value.targetTop,behavior:"smooth"})})});function j(e){var a;s&&(s.value.active=!0,s.value.animation=!0),(a=i==null?void 0:i.value)!=null&&a.class&&(i.value.class.cover=!1),e.class&&(e.class.active=!0,e.class.animation=!0),i&&(i.value=e),G(e.Package)}function q(e){s&&(s.value.active=!1,s.value.cover=!0),e.class&&(e.class.active=!1,e.class.cover=!0),o!=null&&o.value&&(o.value.active=!0)}function N(e,a){a.propertyName==="transform"&&(s&&(s.value.animation=!1),e.class&&(e.class.animation=!1))}const M=m("appDetail");function G(e){W.getApplicationDetail(e).then(a=>{M&&(M.value=a),o!=null&&o.value&&(o.value.loaded=!0)}).catch(a=>{x.notify({type:"negative",message:a.toString()})})}return(e,a)=>(w(),$("div",{class:k(["container",J(s)]),style:D({height:C.value}),ref_key:"container",ref:r},[(w(!0),$(Q,null,U(T.value,(l,n)=>(w(),$("div",{style:D(l.style),class:k(["card",l.class]),key:n,onMousedown:()=>j(l),onMouseup:()=>q(l)},[_("div",{class:"cardView",onTransitionend:c=>N(l,c)},[_("img",{src:l.imgSrc,alt:"",onError:c=>l.imgError=!0},null,40,ne),_("div",oe,[_("h6",null,I(l.Name),1),_("p",null,I(l.More),1)])],40,te)],46,ae))),128))],6))}});var ve=Y(le,[["__scopeId","data-v-0eabdfec"]]);export{ve as default};
