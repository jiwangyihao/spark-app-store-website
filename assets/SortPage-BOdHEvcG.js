import{Q as D}from"./QScrollArea-GzUkkOMT.js";import{d as M,r as u,y as L,ab as W,ac as B,o as f,w as E,a4 as _,i as R,A as p,G as $,D as F,C as s,B as y,E as G,ae as C,I as T,ad as v,H as w,F as N,_ as Q}from"./index-iZyAhOW0.js";import{a as V,u as A}from"./use-quasar-D0EY9UD5.js";import{api as H}from"./api-DAmkVPjC.js";import"./use-dark-BX9Wt4Ho.js";import"./QResizeObserver-aPzZyVnu.js";import"./scroll-UGxYwJNr.js";import"./selection-DT5FFOkM.js";const j=["onMousedown","onMouseup"],q=["onTransitionend"],O=["src","onError"],U={class:"description"},J=M({__name:"SortPage",setup(K){const g=V(),r=u(),i=u(),l=L(),P=W(),o=A(),{sortCache:e}=B(A());f(()=>{E(()=>l.params.sort,()=>{if(l.params.sort&&e.value.sort!==l.params.sort.toString()){e.value.sort=l.params.sort.toString();async function t(){const a=await H.getApplicationList(l.params.sort.toString());a.length>0?(e.value.appList=x(a),e.value.sort=l.params.sort.toString(),cancelAnimationFrame(m.value.animationId),r.value.parentElement.parentElement.scrollTo({top:r.value.parentElement.parentElement.scrollTop,behavior:"smooth"})):await P.push("/Error404")}e.value.coverState.active?(e.value.coverState.active=!1,e.value.coverState.open=!1,e.value.coverState.loaded=!1,e.value.containerState.cover=!1,e.value.coverState.animation=!0,setTimeout(t,2e3)):t().catch(a=>{g.notify({type:"negative",message:a.toString()})})}},{immediate:!0})});const c=u(0);function x(t){return t.forEach((a,n)=>{a.position={left:n%e.value.column*(e.value.horizonGap+e.value.config.gap+e.value.config.cardWidth)+e.value.config.horizonPadding+e.value.horizonGap,top:Math.floor(n/e.value.column)*(e.value.config.cardHeight+e.value.config.gap)+e.value.config.verticalPadding},a.style=`transform:translate(${a.position?.left}px,${a.position?.top}px)`,a.hasOwnProperty("class")||(a.class={active:!1,animation:!1,appCard:!0,cover:!1}),o.setImgError(a,!1)}),t}f(()=>{c.value=r.value?.clientWidth,o.onContainerWidthChange(c.value),window.addEventListener("resize",_(()=>{c.value=r.value?.clientWidth,o.onContainerWidthChange(c.value)},250)),i.value.getScrollTarget().addEventListener("scroll",t=>o.onScroll(t?.target?.scrollTop)),o.onClientHeightChange(i.value.getScrollTarget().parentElement.parentElement.clientHeight-30),i.value.getScrollTarget().parentElement.parentElement.addEventListener("resize",_(()=>{o.onClientHeightChange(i.value.getScrollTarget().parentElement.parentElement.clientHeight-30)},250))});const m=u({originTop:0,targetTop:0,animationId:0});f(()=>{E(o.sortCache,t=>{if(t.columnAnimation.change){const a=t.columnAnimation.newColumn,n=t.columnAnimation.oldColumn;console.log(a,n),t.columnAnimation.change=!1;const d=t.scrollTop;m.value.targetTop=(d-t.config.verticalPadding+r.value.parentElement.parentElement.clientHeight/2)*n/a-r.value.parentElement.parentElement.clientHeight/2+t.config.verticalPadding,r.value.parentElement.parentElement.scrollTo({top:m.value.targetTop,behavior:"smooth"})}},{deep:!0})});function z(t){e.value.containerState.active=!0,e.value.containerState.animation=!0,e.value.activeCard?.class&&(e.value.activeCard.class.cover=!1),t.class&&(t.class.active=!0,t.class.animation=!0),o.setActiveCard(t),k(t.Package)}function I(t){e.value.containerState.active=!1,e.value.containerState.cover=!0,t.class&&(t.class.active=!1,t.class.cover=!0),e.value.coverState.active=!0}function b(t,a){a.propertyName==="transform"&&(e.value.containerState.animation=!1,t.class&&(t.class.animation=!1))}const h=R("appDetail");function k(t){H.getApplicationDetail(t).then(a=>{h&&(h.value=a),e.value.coverState.loaded=!0}).catch(a=>{g.notify({type:"negative",message:a.toString()})})}return(t,a)=>(p(),$(D,{style:{width:"calc(100% - 60px)"},"thumb-style":{zIndex:"2",borderRadius:"100px"},visible:!1,ref_key:"scrollArea",ref:i,class:"scroll-container"},{default:F(()=>[s("div",{class:T(["sort-container",v(e).containerState]),style:C({height:v(e).containerHeight}),ref_key:"container",ref:r},[(p(!0),y(N,null,G(v(e).appList,(n,d)=>(p(),y("div",{style:C(n.style),class:T(["card",n.class]),key:d,onMousedown:()=>z(n),onMouseup:()=>I(n)},[s("div",{class:"cardView",onTransitionend:S=>b(n,S)},[s("img",{src:n.imgSrc,alt:"",onError:S=>v(o).setImgError(n,!0)},null,40,O),s("div",U,[s("h6",null,w(n.Name),1),s("p",null,w(n.More),1)])],40,q)],46,j))),128))],6)]),_:1},512))}}),re=Q(J,[["__scopeId","data-v-84f67579"],["__file","SortPage.vue"]]);export{re as default};
