import{i as g,aG as G,v as V,r as _,x as K,aC as O,aH as Q,o as w,w as H,c as v,a7 as M,z as S,A as $,F as U,D as J,aI as D,E as I,aD as k,B as y,H as W}from"./index.a6c2a884.js";import{api as L}from"./api.31ee6ffb.js";import{u as X}from"./store.d84b6b28.js";import{_ as Y}from"./plugin-vue_export-helper.21dcd24c.js";var Z="/spark-store-qe/assets/application.bc4a430e.svg";function ee(){return g(G)}const ae=["onMousedown","onMouseup"],te=["onTransitionend"],ne=["src","onError"],oe={class:"description"},re=V({__name:"SortPage",setup(le){const x=ee(),l=_(),T=g("cover"),s=g("containerState"),o=g("coverState"),i=g("activeCard"),f=K(),B=O(),{source:C,sortCache:p}=Q(X());w(()=>{H(()=>f.params.sort,()=>{if(f.params.sort&&p.value.sort!==f.params.sort.toString()){p.value.sort=f.params.sort.toString();async function e(){const a=await L.getApplicationList(f.params.sort.toString());a.length>0?(p.value.appList=F(a),p.value.sort=f.params.sort.toString(),cancelAnimationFrame(d.value.animationId),l.value.parentElement.parentElement.scrollTo({top:l.value.parentElement.parentElement.scrollTop,behavior:"smooth"})):await B.push("/Error404")}o!=null&&o.value.active?(o.value.active=!1,o.value.open=!1,o.value.loaded=!1,s!=null&&s.value&&(s.value.cover=!1),o.value.animation=!0,setTimeout(e,2e3)):e().catch(a=>{x.notify({type:"negative",message:a.toString()})})}},{immediate:!0})});const t={cardWidth:264,cardHeight:92,verticalPadding:50,horizonPadding:16,gap:32},h=_(0),b=v(()=>`${Math.ceil(p.value.appList.length/m.value)*(t.cardHeight+t.gap)+t.gap+t.verticalPadding*1.5}px`),m=v(()=>Math.floor((h.value+t.gap-t.horizonPadding*2)/(t.cardWidth+t.gap))),z=v(()=>(h.value-(t.cardWidth+t.gap)*m.value+t.gap-t.horizonPadding*2)/(m.value+1));function F(e){var r;e.forEach((n,c)=>{n.position={left:v(()=>c%m.value*(z.value+t.gap+t.cardWidth)+t.horizonPadding+z.value),top:v(()=>Math.floor(c/m.value)*(t.cardHeight+t.gap)+t.verticalPadding)},n.style=v(()=>{var u,E;return`transform:translate(${(u=n.position)==null?void 0:u.left.value}px,${(E=n.position)==null?void 0:E.top.value}px)`}),n.hasOwnProperty("class")||(n.class={active:!1,animation:!1,appCard:!0,cover:!1}),n.imgError=_(!1);const P=`${C.value}/store/${p.value.sort}/${n.Package.replaceAll("+","%2B")}/icon.png`;n.imgSrc=v(()=>{var u;return(u=n.imgError)!=null&&u.value?Z:P})});const a=_((r=l.value)==null?void 0:r.parentElement.parentElement.scrollTop);return T!=null&&T.value&&(T.value.style=v(()=>{var n,c,P,u,E;return`--j-left:${((c=(n=i==null?void 0:i.value)==null?void 0:n.position)==null?void 0:c.left)-h.value/2-30}px;--j-top:${((u=(P=i==null?void 0:i.value)==null?void 0:P.position)==null?void 0:u.top)-((E=l.value)==null?void 0:E.parentElement.parentElement.clientHeight)/2-a.value-15}px;`})),l.value.parentElement.parentElement.addEventListener("scroll",M(()=>{var n;d.value.animationId||(a.value=(n=l.value)==null?void 0:n.parentElement.parentElement.scrollTop)},250)),e}w(()=>{var e;h.value=(e=l.value)==null?void 0:e.clientWidth,window.addEventListener("resize",M(()=>{var a;h.value=(a=l.value)==null?void 0:a.clientWidth},250))});const d=_({originTop:0,targetTop:0,animationId:0});w(()=>{H(m,(e,a)=>{cancelAnimationFrame(d.value.animationId);const r=d.value.targetTop?d.value.targetTop:l.value.parentElement.parentElement.scrollTop;d.value.targetTop=(r-t.verticalPadding+l.value.parentElement.parentElement.clientHeight/2)*a/e-l.value.parentElement.parentElement.clientHeight/2+t.verticalPadding,l.value.parentElement.parentElement.scrollTo({top:d.value.targetTop,behavior:"smooth"})})});function j(e){var a;s&&(s.value.active=!0,s.value.animation=!0),(a=i==null?void 0:i.value)!=null&&a.class&&(i.value.class.cover=!1),e.class&&(e.class.active=!0,e.class.animation=!0),i&&(i.value=e),R(e.Package)}function q(e){s&&(s.value.active=!1,s.value.cover=!0),e.class&&(e.class.active=!1,e.class.cover=!0),o!=null&&o.value&&(o.value.active=!0)}function N(e,a){a.propertyName==="transform"&&(s&&(s.value.animation=!1),e.class&&(e.class.animation=!1))}const A=g("appDetail");function R(e){L.getApplicationDetail(e).then(a=>{A&&(A.value=a),o!=null&&o.value&&(o.value.loaded=!0)}).catch(a=>{x.notify({type:"negative",message:a.toString()})})}return(e,a)=>(S(),$("div",{class:I(["sort-container",D(s)]),style:k({height:b.value}),ref_key:"container",ref:l},[(S(!0),$(U,null,J(D(p).appList,(r,n)=>(S(),$("div",{style:k(r.style),class:I(["card",r.class]),key:n,onMousedown:()=>j(r),onMouseup:()=>q(r)},[y("div",{class:"cardView",onTransitionend:c=>N(r,c)},[y("img",{src:r.imgSrc,alt:"",onError:c=>r.imgError=!0},null,40,ne),y("div",oe,[y("h6",null,W(r.Name),1),y("p",null,W(r.More),1)])],40,te)],46,ae))),128))],6))}});var ve=Y(re,[["__scopeId","data-v-c1900012"]]);export{ve as default};
